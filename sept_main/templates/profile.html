{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
#userprofile{
    position: absolute;
    top: 20px;
    width:230px;
    border: 1px solid red;
    margin-left: 1000px;
    padding: 10px;
    background-color: aqua;
    border-radius: 10px;
    background-color: aqua;
}

.category{
    box-sizing: border-box;
    padding-top:80px;
    border:1px solid red;
    border-radius: 10px ;
    width:400px;
    height:300px;
    background-color: rgb(0, 255, 17);
    margin: 10px;

}
#display{
    display: flex;
}
</style>
<body>
    
    <div id="display">
        <div class="category">
            <h3>Books available in Librariy</h3>
            <form action="{% url 'take_book' %}" method="post">
                {% csrf_token %} 
                <select id="category-dropdown" name="category-dropdown">
                    <option value="">Select a category</option>
                    {% for category in all_categories %}
                        <option value="{{ category.Categorie_id }}">{{ category.Categorie_name }}</option>
                    {% endfor %}
                </select>
                <select id="book-dropdown">
                    <option value="">Select a book</option>
                </select>
                <button type="submit">submit</button>
            </form>
        </div>
        <div class="category">
            <div>
                <h3>Books Taken</h3>
                <form action="{% url 'returnbook' %}" method="post">
                    {% csrf_token %} 
                    <ol>
                        {% for book in user_taken_books %}
                        <li>
                            {{ book.book_name }}
                            <input type="hidden" name="return_book_id" value="{{ book.bookid }}">
                            <button type="submit">Return</button>
                        </li>
                        {% endfor %}
                    </ol>
                </form>
            </div>
            
        </div>
    </div>



<script>
    // Add the JavaScript/jQuery code here
    $(document).ready(function() {
        // Handle change event of category dropdown
        $("#category-dropdown").change(function() {
            var category_id = $(this).val();
            console.log(category_id)
            if (category_id) {
                $.ajax({
                    url: "{% url 'get_books_by_category' %}",
                    data: { category_id: category_id },
                    dataType: 'json',
                    success: function(data) {
                        // Clear existing options
                        $("#book-dropdown").html('<option value="">Select a book</option>');

                        // Populate the book dropdown with retrieved data
                        $.each(data.books, function(key, value) {
                            $("#book-dropdown").append('<option value="' + value.id + '">' + value.book_name + '</option>');
                        });
                    }
                });
            } else {
                // If no category selected, clear the book dropdown
                $("#book-dropdown").html('<option value="">Select a book</option>');
            }
        });
    });
</script>










<div id="userprofile">
    {% block content %}
  <h2>Your Profile</h2>
  <p><strong>Username Name:</strong> {{ user.customer_name }}</p>
  <p><strong>Email:</strong> {{ user.email }}</p>
  <p><strong>Date of Birth:</strong> {{ user.dob }}</p>
  <p><strong>Address:</strong> {{ user.address }}</p>
  <p><strong>Gender:</strong> {{ user.gender }}</p>
  <a href="{% url 'custom_logout' %}">Logout</a>
{% endblock %}
</div>
</body>
</html>